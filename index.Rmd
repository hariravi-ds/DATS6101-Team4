---
title: "Rice Production"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

---

```{r lib}
library(ezids)
```

```{r pi}
#load the dataset
rice_prod <- read.csv("C:/Users/HARI/Documents/DATS6101-Team4/Rice Production Data.csv")

#display top six rows of the dataset
head(rice_prod)

xkabledplyhead(rice_prod, title = "Rice Production")
```

```{r}
#display the shape of dataset
dim(rice_prod)
```

```{r col}
#display the column names of dataset
colnames(rice_prod)
```

```{r modify}

#defining name_map to rename the columns
name_map <- c(
  "Production..t." = "Production",
  "production__tonnes__per_capita" = "Production_per_capita(kg)",
  "Production.per.capita..kg." = "Production_per_capita(kg)",
  "Yield..t.ha." = "Yield(t/ha)",
  "Land.Use..ha." = "Land_Use",
  "area_harvested__ha__per_capita" = "Area_Harvested(ha_per_capita)",
  "Land.Use.per.capita..m.." = "Land_Use_per_Capita",
  "Imports..t." = "Imports(t)",
  "imports__tonnes__per_capita" = "Imports(t_per_capita)",
  "Imports.per.capita..kg." = "Imports_per_capita(kg)",
  "Exports..t." = "Exports(t)",
  "exports__tonnes__per_capita" = "Exports(t_per_capita)",
  "Exports.per.capita..kg." = "Exports_per_capita(kg)",
  "Domestic.supply..t." = "Domestic_Supply(t)",
  "domestic_supply__tonnes__per_capita" = "Domestic_Supply(t_per_capita)",
  "Domestic.supply.per.capita..kg." = "Domestic_Supply_per_Capita(kg)",
  "Food..t." = "Food(t)",
  "food__tonnes__per_capita" = "Food(t_per_capita)",
  "Food.per.capita..kg." = "Food_per_Capita(kg)",
  "Animal.feed..t." = "Animal_Feed(t)",
  "feed__tonnes__per_capita" = "Animal_Feed(t_per_capita)",
  "Animal.feed.per.capita..kg." = "Animal_Feed_per_Capita(kg)",
  "Other.uses..t." = "Other_Uses(t)",
  "other_uses__tonnes__per_capita" = "Other_Uses(t_per_capita)",
  "Other.uses.per.capita..kg." = "Other_uses_per_capita(kg)",
  "Supply.chain.waste..t." = "Supply_Chain_Waste(t)",
  "waste_in_supply_chain__tonnes__per_capita" = "Waste_in_supply_chain(t_per_capita)",
  "Supply.chain.waste.per.capita..kg." = "Supply_chain_waste_per_Capita(kg)",
  "Food.supply..kg.per.capita.per.year." = "Food_supply(kg_per_capita_per_day)",
  "Food.supply..g.per.capita.per.day." = "Food_supply(g_per_capita_per_day)",
  "Food.supply..kcal.per.capita.per.day." = "Food_supply(kcal_per_capita_per_day)",
  "Food.supply..Protein.g.per.capita.per.day." = "Food_supply(Protein_per_capita_per_day)",
  "Food.supply..Fat.g.per.capita.per.day." = "Food_supply(Fat_per_capita_per_day)"
)

#rename the columns based on name_map
for (old_name in colnames(rice_prod)) {
  if (old_name %in% names(name_map)) {
    colnames(rice_prod)[colnames(rice_prod) == old_name] <- name_map[old_name]
  }
}

#display the changed column names
colnames(rice_prod)
```
```{r}
#hari
# Load necessary libraries
library(dplyr)
library(ggplot2)
library(zoo)

columns_of_interest <-
  c("Country", "Year", "Production", "Population", "Land_Use")

df_filtered <- rice_prod %>%
  select(columns_of_interest)

#filtering data between 1980 and 2020
df_filtered <- df_filtered[df_filtered$Year >= 1980 &
                             df_filtered$Year <= 2020, ]

#displaying the dimension of filtered data
dim(df_filtered)
```

```{r}
#to check the number of missing values for each column
no_of_na = missing_values <- colSums(is.na(df_filtered))
no_of_na

#removing countries for which all values are NA
df_cleaned <- df_filtered %>%
  group_by(Country) %>%
  filter(any(!is.na(Land_Use))) %>%
  ungroup()

#removing countries for which all values are 0
df_cleaned <- df_cleaned %>%
  group_by(Country) %>%
  filter(any(Land_Use > 0)) %>%
  ungroup()


#display the dimension after removing countries with all values as 0 or NA
dim(df_cleaned)

# Calculate growth rates
population_data <- df_cleaned %>%
  mutate(GrowthRate = (Population - lag(Population)) / lag(Population))

#calculating mean growth rate
average_growth_rate <- mean(population_data$GrowthRate, na.rm = TRUE)

#function to impute data based on calcualted growth rate
impute_population <- function(data, avg_growth) {
  for (i in 1:nrow(data)) {
    if (is.na(data$Population[i])) {
      previous_population <- data$Population[i - 1]  # Last known population
      data$Population[i] <- previous_population * (1 + avg_growth)  # Impute using growth rate
    }
  }
  return(data)
}

# Impute missing values
population_data <- impute_population(population_data, average_growth_rate)

#group by data to mutate the land_use for specific countries
population_data <- population_data %>%
  group_by(Country) %>%
  mutate(Land_Use = na.approx(Land_Use, na.rm = FALSE)) %>%
  ungroup()

population_data$Land_Use <- na.approx(population_data$Land_Use)

final_df <- population_data %>%
  select(columns_of_interest)

final_df <- final_df %>% filter(Country != "Micronesia (FAO)")

colSums(is.na(final_df))
```
```{r}
library(patchwork)

plots <- list()
for (col in c("Population", "Production", "Land_Use")) {
  if (is.numeric(final_df[[col]])) {
    p <- ggplot(final_df, aes_string(x = col)) +
      geom_histogram(bins = 30,
                     color = "black",
                     fill = "blue") +
      labs(title = paste("Histogram of ", col),
           x = col,
           y = "Count")
    plots[[col]] <- p
  }
}
combined_plot <- wrap_plots(plots, ncol = 2)  # Adjust ncol for layout
print(combined_plot)
```
```{r}

#scatter plot with production vs other parameters colured by country
# Create a list to store plots
plots <- list()

# Loop through each parameter and create a scatter plot
for (col in c("Population", "Land_Use")) {
  p <- ggplot(final_df,
              aes_string(x = "Production", y = col, color = "Country")) +
    geom_point() +
    labs(
      title = paste("Scatter Plot of Production vs", col, "coloured by country"),
      x = "Production",
      y = col
    ) +
    theme_minimal() +
    theme(legend.position = "none")
  
  plots[[col]] <- p  #Store the plot in the list
}

#Combine all plots into a single layout
combined_plot <- wrap_plots(plots, ncol = 1)  # Adjust ncol for layout
print(combined_plot)

#scatter plot with production vs other parameters coloured by year
#Create a list to store plots
plots <- list()

# Loop through each parameter and create a scatter plot
for (col in c("Population", "Land_Use")) {
  p <- ggplot(final_df, aes_string(x = "Production", y = col, color = "Year")) +
    geom_point() +
    labs(
      title = paste("Scatter Plot of Production vs", col, "coloured by year"),
      x = "Production",
      y = col
    ) +
    theme_minimal() +
    theme(legend.position = "none")
  
  plots[[col]] <- p  #Store the plot in the list
}

# Combine all plots into a single layout
combined_plot <- wrap_plots(plots, ncol = 1)  # Adjust ncol for layout
print(combined_plot)

#Production over time for each country
ggplot(final_df, aes(x = Year, y = Production, color = Country)) +
  geom_line(alpha = 0.7, size = 1) +
  labs(title = "Production Over Time by Country", x = "Year", y = "Population") + theme_minimal() +
  theme(legend.position = "none")

#total population by year
total_prod <- final_df %>%
  group_by(Year) %>%
  summarise(total_prod = sum(Production))

ggplot(total_prod, aes(x = Year, y = total_prod)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Total Production by Year", x = "Year", y = "Total Production") +
  theme_minimal()

```
