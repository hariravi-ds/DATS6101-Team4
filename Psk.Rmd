---
title: "Rice Production"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

---

```{r lib}
library(ezids)
library(dplyr)
library(ggplot2)
library(zoo)
```

```{r pi}
rice_prod <- read.csv("C:\\Users\\HP\\Downloads\\Rice Production Data (2).csv")
head(rice_prod)
xkabledplyhead(rice_prod, title = "Rice Production")
```

```{r modify}

#defining name_map to rename the columns
name_map <- c(
  "Production..t." = "Production",
  "production__tonnes__per_capita" = "Production_per_capita(kg)",
  "Production.per.capita..kg." = "Production_per_capita(kg)",
  "Yield..t.ha." = "Yield(t/ha)",
  "Land.Use..ha." = "Land_Use",
  "area_harvested__ha__per_capita" = "Area_Harvested(ha_per_capita)",
  "Land.Use.per.capita..m.." = "Land_Use_per_Capita",
  "Imports..t." = "Imports(t)",
  "imports__tonnes__per_capita" = "Imports(t_per_capita)",
  "Imports.per.capita..kg." = "Imports_per_capita(kg)",
  "Exports..t." = "Exports(t)",
  "exports__tonnes__per_capita" = "Exports(t_per_capita)",
  "Exports.per.capita..kg." = "Exports_per_capita(kg)",
  "Domestic.supply..t." = "Domestic_Supply_t",
  "domestic_supply__tonnes__per_capita" = "Domestic_Supply(t_per_capita)",
  "Domestic.supply.per.capita..kg." = "Domestic_Supply_per_Capita(kg)",
  "Food..t." = "Food(t)",
  "food__tonnes__per_capita" = "Food(t_per_capita)",
  "Food.per.capita..kg." = "Food_per_Capita(kg)",
  "Animal.feed..t." = "Animal_Feed(t)",
  "feed__tonnes__per_capita" = "Animal_Feed(t_per_capita)",
  "Animal.feed.per.capita..kg." = "Animal_Feed_per_Capita(kg)",
  "Other.uses..t." = "Other_Uses(t)",
  "other_uses__tonnes__per_capita" = "Other_Uses(t_per_capita)",
  "Other.uses.per.capita..kg." = "Other_uses_per_capita(kg)",
  "Supply.chain.waste..t." = "Supply_Chain_Waste_t",
  "waste_in_supply_chain__tonnes__per_capita" = "Waste_in_supply_chain(t_per_capita)",
  "Supply.chain.waste.per.capita..kg." = "Supply_chain_waste_per_Capita(kg)",
  "Food.supply..kg.per.capita.per.year." = "Food_supply(kg_per_capita_per_day)",
  "Food.supply..g.per.capita.per.day." = "Food_supply(g_per_capita_per_day)",
  "Food.supply..kcal.per.capita.per.day." = "Food_supply(kcal_per_capita_per_day)",
  "Food.supply..Protein.g.per.capita.per.day." = "Food_supply(Protein_per_capita_per_day)",
  "Food.supply..Fat.g.per.capita.per.day." = "Food_supply(Fat_per_capita_per_day)"
)

#rename the columns based on name_map
for (old_name in colnames(rice_prod)) {
  if (old_name %in% names(name_map)) {
    colnames(rice_prod)[colnames(rice_prod) == old_name] <- name_map[old_name]
  }
}

#display the changed column names
colnames(rice_prod)
```
```{r filtered}

columns <-
  c("Country", "Year","Production","Domestic_Supply_t","Food(t)","Supply_Chain_Waste_t")

fil_data <- rice_prod %>% select((columns))

#filtering data between 1980 and 2020
fil_data <- fil_data[fil_data$Year >= 1980 &
                             fil_data$Year <= 2020, ]

#displaying the dimension of filtered data
dim(fil_data)
colnames(fil_data)

```

```{r null}
#to check the number of missing values for each column
na_val = missing_values <- colSums(is.na(fil_data))
na_val
dim(fil_data)
```
```{r clean}
cleaned_data <- na.omit(fil_data)

dim(cleaned_data)
colnames(cleaned_data)
```


```{r desc}

# Initialize a list to store results
descriptive_stats <- list()

# Count of unique countries
descriptive_stats$Country_Count <- n_distinct(cleaned_data$Country)

# Year statistics
descriptive_stats$Year_Min <- min(cleaned_data$Year, na.rm = TRUE)
descriptive_stats$Year_Max <- max(cleaned_data$Year, na.rm = TRUE)

# Production statistics
descriptive_stats$Production_Mean <- mean(cleaned_data$Production, na.rm = TRUE)
descriptive_stats$Production_SD <- sd(cleaned_data$Production, na.rm = TRUE)
descriptive_stats$Production_Median <- median(cleaned_data$Production, na.rm = TRUE)
descriptive_stats$Production_Min <- min(cleaned_data$Production, na.rm = TRUE)
descriptive_stats$Production_Max <- max(cleaned_data$Production, na.rm = TRUE)

# Domestic Supply statistics
descriptive_stats$Domestic_Supply_t_Mean <- mean(cleaned_data$Domestic_Supply_t, na.rm = TRUE)
descriptive_stats$Domestic_Supply_t_SD <- sd(cleaned_data$Domestic_Supply_t, na.rm = TRUE)
descriptive_stats$Domestic_Supply_t_Median <- median(cleaned_data$Domestic_Supply_t, na.rm = TRUE)
descriptive_stats$Domestic_Supply_t_Min <- min(cleaned_data$Domestic_Supply_t, na.rm = TRUE)
descriptive_stats$Domestic_Supply_t_Max <- max(cleaned_data$Domestic_Supply_t, na.rm = TRUE)

# Food(t) statistics
descriptive_stats$Food_t_Mean <- mean(cleaned_data$`Food(t)`, na.rm = TRUE)
descriptive_stats$Food_t_SD <- sd(cleaned_data$`Food(t)`, na.rm = TRUE)
descriptive_stats$Food_t_Median <- median(cleaned_data$`Food(t)`, na.rm = TRUE)
descriptive_stats$Food_t_Min <- min(cleaned_data$`Food(t)`, na.rm = TRUE)
descriptive_stats$Food_t_Max <- max(cleaned_data$`Food(t)`, na.rm = TRUE)

# Supply Chain Waste statistics
descriptive_stats$Supply_Chain_Waste_t_Mean <- mean(cleaned_data$Supply_Chain_Waste_t, na.rm = TRUE)
descriptive_stats$Supply_Chain_Waste_t_SD <- sd(cleaned_data$Supply_Chain_Waste_t, na.rm = TRUE)
descriptive_stats$Supply_Chain_Waste_t_Median <- median(cleaned_data$Supply_Chain_Waste_t, na.rm = TRUE)
descriptive_stats$Supply_Chain_Waste_t_Min <- min(cleaned_data$Supply_Chain_Waste_t, na.rm = TRUE)
descriptive_stats$Supply_Chain_Waste_t_Max <- max(cleaned_data$Supply_Chain_Waste_t, na.rm = TRUE)

# Convert the list to a data frame for better display
descriptive_stats_df <- as.data.frame(do.call(rbind, descriptive_stats))

# View the descriptive statistics
print(descriptive_stats_df)


```

```{r domestic }
#ANOVA test to Analyzing Domestic Supply by Year
aov_result <- aov(Domestic_Supply_t ~ Year, data = cleaned_data)
summary(aov_result)

mean_supply_by_year <- cleaned_data %>%
  group_by(Year) %>%
  summarise(Mean_Domestic_Supply = mean(Domestic_Supply_t, na.rm = TRUE))

# Line graph for Domestic Supply by Year
ggplot(mean_supply_by_year, aes(x = Year, y = Mean_Domestic_Supply)) +
  geom_line(color = "blue", size = 1) +
  geom_point(color = "red", size = 2) +  # Add points for clarity
  labs(title = "Mean Domestic Supply by Year",
       x = "Year",
       y = "Mean Domestic Supply (t)") +
  theme_minimal()

```

```{r food_supply}
aov_result <- aov(`Food(t)` ~ Country, data = cleaned_data)
summary(aov_result)

# Load necessary packages
library(ggplot2)
library(dplyr)

# Define the time periods
periods <- list(
  `1980-1990` = cleaned_data %>% filter(Year >= 1980 & Year < 1991),
  `1991-2000` = cleaned_data %>% filter(Year >= 1991 & Year < 2001),
  `2001-2009` = cleaned_data %>% filter(Year >= 2001 & Year < 2010),
  `2009-2020` = cleaned_data %>% filter(Year >= 2009 & Year <= 2020)
)

# Create a list to store plots
plots <- list()

# Loop through the periods and create plots
for (period in names(periods)) {
  mean_food_supply <- periods[[period]] %>%
    group_by(Country) %>%
    summarise(Mean_Food_Supply = mean(`Food(t)`, na.rm = TRUE))

  p <- ggplot(mean_food_supply, aes(x = reorder(Country, -Mean_Food_Supply), y = Mean_Food_Supply)) +
    geom_bar(stat = "identity", fill = "skyblue") +
    labs(title = paste("Mean Food Supply by Country (", period, ")", sep = ""),
         x = "Country",
         y = "Mean Food Supply (t)") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
  plots[[period]] <- p
}

# Print the plots
for (p in plots) {
  print(p)
}


```

```{r supply}
aov_result <- aov(Supply_Chain_Waste_t ~ Year, data = cleaned_data)
summary(aov_result)

mean_waste_by_year <- cleaned_data %>%
  group_by(Year) %>%
  summarise(Mean_Supply_Chain_Waste = mean(Supply_Chain_Waste_t, na.rm = TRUE))

# Line plot for Supply Chain Waste by Year
ggplot(mean_waste_by_year, aes(x = Year, y = Mean_Supply_Chain_Waste)) +
  geom_line(color = "blue", size = 1) +  # Line
  geom_point(color = "red", size = 2) +  # Points for clarity
  labs(title = "Mean Supply Chain Waste by Year",
       x = "Year",
       y = "Mean Supply Chain Waste (t)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

```

```{r food _waste}
# Assuming cleaned_data already contains the relevant columns
# Assuming cleaned_data already contains the relevant columns
cleaned_data <- cleaned_data %>%
  mutate(Food_Waste = Production - Domestic_Supply_t - Supply_Chain_Waste_t)

# View the updated dataset with Food Waste
head(cleaned_data)



```


```{r corr }

library(reshape2)
# Calculate the correlation matrix
cor_matrix <- cleaned_data %>%
  select(Production, Domestic_Supply_t, Food_Waste, Supply_Chain_Waste_t) %>%
  cor(use = "complete.obs")

# Reshape the correlation matrix for ggplot
cor_melted <- melt(cor_matrix)

# Create the heat map
ggplot(data = cor_melted, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile() +  # Create the tiles
  scale_fill_gradient2(low = "aquamarine2", high = "skyblue", mid = "white", 
                       midpoint = 0, limit = c(-1, 1), 
                       name = "Correlation") +
  labs(title = "Correlation Heat Map",
       x = "Variables",
       y = "Variables") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```










