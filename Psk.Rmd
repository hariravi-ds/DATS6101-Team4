---
title: "Rice Production"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---

---

```{r lib}
library(ezids)
library(dplyr)
```

```{r pi}
rice_prod <- read.csv("C:\\Users\\HP\\Downloads\\Rice Production Data (2).csv")
head(rice_prod)
xkabledplyhead(rice_prod, title = "Rice Production")
```

```{r modify}

#defining name_map to rename the columns
name_map <- c(
  "Production..t." = "Production",
  "production__tonnes__per_capita" = "Production_per_capita(kg)",
  "Production.per.capita..kg." = "Production_per_capita(kg)",
  "Yield..t.ha." = "Yield(t/ha)",
  "Land.Use..ha." = "Land_Use",
  "area_harvested__ha__per_capita" = "Area_Harvested(ha_per_capita)",
  "Land.Use.per.capita..m.." = "Land_Use_per_Capita",
  "Imports..t." = "Imports(t)",
  "imports__tonnes__per_capita" = "Imports(t_per_capita)",
  "Imports.per.capita..kg." = "Imports_per_capita(kg)",
  "Exports..t." = "Exports(t)",
  "exports__tonnes__per_capita" = "Exports(t_per_capita)",
  "Exports.per.capita..kg." = "Exports_per_capita(kg)",
  "Domestic.supply..t." = "Domestic_Supply(t)",
  "domestic_supply__tonnes__per_capita" = "Domestic_Supply(t_per_capita)",
  "Domestic.supply.per.capita..kg." = "Domestic_Supply_per_kg",
  "Food..t." = "Food(t)",
  "food__tonnes__per_capita" = "Food(t_per_capita)",
  "Food.per.capita..kg." = "Food_Supply_kg",
  "Animal.feed..t." = "Animal_Feed(t)",
  "feed__tonnes__per_capita" = "Animal_Feed(t_per_capita)",
  "Animal.feed.per.capita..kg." = "Animal_Feed_per_Capita(kg)",
  "Other.uses..t." = "Other_Uses(t)",
  "other_uses__tonnes__per_capita" = "Other_Uses(t_per_capita)",
  "Other.uses.per.capita..kg." = "Other_uses_per_capita(kg)",
  "Supply.chain.waste..t." = "Supply_Chain_Waste(t)",
  "waste_in_supply_chain__tonnes__per_capita" = "Waste_in_supply_chain(t_per_capita)",
  "Supply.chain.waste.per.capita..kg." = "Supply_chain_waste_per_kg",
  "Food.supply..kg.per.capita.per.year." = "Food_supply_kg_per_capita_per_day",
  "Food.supply..g.per.capita.per.day." = "Food_supply(g_per_capita_per_day)",
  "Food.supply..kcal.per.capita.per.day." = "Food_supply(kcal_per_capita_per_day)",
  "Food.supply..Protein.g.per.capita.per.day." = "Food_supply(Protein_per_capita_per_day)",
  "Food.supply..Fat.g.per.capita.per.day." = "Food_supply(Fat_per_capita_per_day)"
)

#rename the columns based on name_map
for (old_name in colnames(rice_prod)) {
  if (old_name %in% names(name_map)) {
    colnames(rice_prod)[colnames(rice_prod) == old_name] <- name_map[old_name]
  }
}

#display the changed column names
colnames(rice_prod)
```
```{r supply}
# Load necessary libraries
library(dplyr)
library(ggplot2)
library(zoo)
library(dplyr)

colnames(rice_prod)[colnames(rice_prod) == "Supply_chain_waste_per_Capita(kg)"] <- "Supply_chain_waste_kg"
colnames(rice_prod)[colnames(rice_prod) == "Food_supply(kg_per_capita_per_day)"] <- "Food_supply_kg_per_day"
colnames(rice_prod)[colnames(rice_prod) == "Domestic_Supply_per_Capita(kg)"] <- "Domestic_supply_kg"

columns <-
  c("Country", "Year","Supply_chain_waste_per_kg","Food_supply_kg_per_capita_per_day","Domestic_Supply_per_kg")

fil_data <- rice_prod %>%
  select(all_of(columns))

#filtering data between 1980 and 2020
fil_data <- fil_data[fil_data$Year >= 1980 &
                             fil_data$Year <= 2020, ]

#displaying the dimension of filtered data
dim(fil_data)
colnames(fil_data)
```


```{r}
#to check the number of missing values for each column
na_val = missing_values <- colSums(is.na(fil_data))
na_val
```



```{r fil}
agri_data <- fil_data %>%
  group_by(Country) %>%
  filter(any(!is.na(`Supply_chain_waste_per_kg`)) | 
           any(!is.na(`Food_supply_kg_per_capita_per_day`)) | 
           any(!is.na(`Domestic_Supply_per_kg`))) %>%
  ungroup()
agri_data
dim(agri_data)
```
```{r sum}


#Calculate mean, median, and standard deviation for specified parameters
summary_stats <- agri_data %>%
  summarize(
    Mean_Food_Supply = mean(Food_supply_kg_per_capita_per_day, na.rm = TRUE),
    Median_Food_Supply = median(Food_supply_kg_per_capita_per_day, na.rm = TRUE),
    SD_Food_Supply = sd(Food_supply_kg_per_capita_per_day, na.rm = TRUE),
    
    Mean_Waste = mean(Supply_chain_waste_per_kg, na.rm = TRUE),
    Median_Waste = median(Supply_chain_waste_per_kg, na.rm = TRUE),
    SD_Waste = sd(Supply_chain_waste_per_kg, na.rm = TRUE),
    
    Mean_Domestic_Supply = mean(Domestic_Supply_per_kg, na.rm = TRUE),
    Median_Domestic_Supply = median(Domestic_Supply_per_kg, na.rm = TRUE),
    SD_Domestic_Supply = sd(Domestic_Supply_per_kg, na.rm = TRUE)
  )

# Print summary statistics
print(summary_stats)
```
```{r trend}
#  Analyze trends over time 
trend_data <- agri_data %>%
  group_by(Year) %>%
  summarize(
    Avg_Food_Supply = mean(Food_supply_kg_per_capita_per_day, na.rm = TRUE),
    Avg_Waste = mean(Supply_chain_waste_per_kg, na.rm = TRUE),
    Avg_Domestic_Supply = mean(Domestic_Supply_per_kg, na.rm = TRUE)
  )

# Plot trends over time
# Food Supply Trend
ggplot(trend_data, aes(x = Year)) +
  geom_line(aes(y = Avg_Food_Supply, color = "Food Supply"), size = 1) +
  geom_line(aes(y = Avg_Waste, color = "Waste"), size = 1, linetype = "dashed") +
  geom_line(aes(y = Avg_Domestic_Supply, color = "Domestic Supply"), size = 1, linetype = "dotted") +
  labs(title = "Trends Over Time",
       x = "Year",
       y = "Average (kg per capita per day)",
       color = "Legend") +
  theme_minimal()

# Display the plot
```

```{r str}
str(agri_data)

```
```{r com}
comparison_data <- agri_data %>%
  group_by(Country) %>%
  summarize(
    Avg_Food_Supply = mean(Food_supply_kg_per_capita_per_day, na.rm = TRUE),
    Avg_Waste = mean(Supply_chain_waste_per_kg, na.rm = TRUE)
  )

``` 
```{r bar1}
ggplot(comparison_data, aes(x = reorder(Country, -Avg_Food_Supply), y = Avg_Food_Supply)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  geom_bar(aes(y = Avg_Waste), stat = "identity", fill = "red", alpha = 0.5) +
  labs(title = "Average Food Supply and Waste Per Capita by Country",
       x = "Country",
       y = "Average (kg per capita)",
       fill = "Legend") +
  theme_minimal() +
  scale_y_continuous(sec.axis = sec_axis(~ ., name = "Waste (kg per capita)")) +
  theme(axis.text.x = element_text(angle =45, hjust = 1.2))
```

```{r Analysis}
# Analyze Domestic Supply Variation Between Developed and Developing Countries

# Define developed and developing countries 
developed_countries <- c("United States", "Canada", "India", "United Kingdom", "France","Germany")  
agri_data <- agri_data %>%
  mutate(Development_Status = ifelse(Country %in% developed_countries, "Developed", "Developing"))

# Summarize domestic supply by development status
domestic_supply_comparison <- agri_data %>%
  group_by(Development_Status) %>%
  summarize(Avg_Domestic_Supply = mean(Domestic_Supply_per_kg, na.rm = TRUE))

# Create a bar plot for domestic supply comparison
ggplot(domestic_supply_comparison, aes(x = Development_Status, y = Avg_Domestic_Supply, fill = Development_Status)) +
  geom_bar(stat = "identity") +
  labs(title = "Average Domestic Supply Per Capita by Development Status",
       x = "Development Status",
       y = "Average Domestic Supply (kg per capita)") +
  theme_minimal()

# Display the plots
print(comparison_data)
print(domestic_supply_comparison)
```

```{r diff_plot}
# Load necessary libraries


# Step 1: Define developed countries
developed_countries <- c("USA", "Canada", "Germany", "UK", "France")  # Add more as needed

# Step 2: Filter the dataset for developed countries
developed_data <- agri_data %>%
  filter(Country %in% developed_countries)

# Step 3: Create a plot for each developed country
ggplot(developed_data, aes(x = Year)) +
  geom_line(aes(y = Food_supply_kg_per_capita_per_day, color = "Food Supply"), size = 1) +
  geom_line(aes(y = Supply_chain_waste_per_kg, color = "Waste"), size = 1, linetype = "dashed") +
  labs(title = "Food Supply and Waste Per Capita Over Time for Developed Countries",
       x = "Year",
       y = "Kg per Capita",
       color = "Legend") +
  facet_wrap(~ Country) +  # Create separate plots for each country
  theme_minimal() +
  theme(legend.position = "bottom")

# Display the plot


```

```{r hist}
# Load necessary libraries
library(dplyr)
library(ggplot2)

# Sample data (replace this with your actual data)
# agriculture_data <- read.csv("path_to_your_data.csv")

# Step 1: Define developed countries
developed_countries <- c("USA", "Canada", "Germany", "UK", "France")  # Add more as needed

# Step 2: Filter the dataset for developed countries
developed_data <- agri_data %>%
  filter(Country %in% developed_countries)

# Create histograms for Food Supply and Waste Per Capita
# Food Supply Histogram
food_supply_hist <-ggplot(developed_data, aes(x = Food_supply_kg_per_capita_per_day, fill = Country)) +
  geom_histogram(binwidth = 10, position = "dodge", color = "black") +
  labs(title = "Histogram of Food Supply Per Capita for Developed Countries",
       x = "Food Supply (kg per capita)",
       y = "Frequency") +
  theme_minimal() +
  theme(legend.position = "bottom")

# Waste Per Capita Histogram
waste_hist <-ggplot(developed_data, aes(x = Supply_chain_waste_per_kg, fill = Country)) +
  geom_histogram(binwidth = 1, position = "dodge", color = "black") +
  labs(title = "Histogram of Supply Chain Waste Per Capita for Developed Countries",
       x = "Waste (kg per capita)",
       y = "Frequency") +
  theme_minimal() +
  theme(legend.position = "bottom")

# Display the plots

```

```{r corr}
install.packages("ggcorrplot")

library(reshape2)
library(ggcorrplot)


#Select relevant columns for correlation analysis
correlation_data <- agri_data %>%
  select(Food_supply_kg_per_capita_per_day, Supply_chain_waste_per_kg,Domestic_Supply_per_kg)

# Calculate the correlation matrix
correlation_matrix <- cor(correlation_data, use = "complete.obs")

# Convert the correlation matrix to a long format for ggplot
correlation_melted <- melt(correlation_matrix)

# Create a heatmap using ggcorrplot
ggcorrplot(correlation_matrix, 
           method = "circle", 
           type = "lower", 
           lab = TRUE, 
           lab_size = 3, 
           colors = c("blue", "white", "red"), 
           title = "Correlation Matrix Heatmap",
           ggtheme = theme_minimal())

# Display the correlation matrix
print(correlation_matrix)

```